(function(){"use strict";let i,n,e,F,c,A,u,a;function B(f){const w=Atomics.load(c,1);if(Atomics.add(c,0,1)+1===f)Atomics.store(c,0,0),Atomics.add(c,1,1),Atomics.notify(c,1);else for(;Atomics.load(c,1)===w;)Atomics.wait(c,1,w)}self.onmessage=f=>{const{type:w}=f.data;if(w==="init"){const{sharedBuffer:r,workerId:l,workerCount:d,maxBodies:m}=f.data;A=l,u=d,a=m;let s=0;i=new Float64Array(r,s,a*3),s+=a*3*8,n=new Float64Array(r,s,a*3),s+=a*3*8,e=new Float64Array(r,s,a*3),s+=a*3*8,F=new Float64Array(r,s,a),s+=a*8,c=new Int32Array(r,s,2),console.log(`Worker ${A} initialized.`)}if(w==="step"){const{count:r,dt:l}=f.data,d=.5*l,m=Math.ceil(r/u),s=A*m,y=Math.min(s+m,r);for(let o=s;o<y;o++){const t=o*3;n[t]+=e[t]*d,n[t+1]+=e[t+1]*d,n[t+2]+=e[t+2]*d,i[t]+=n[t]*l,i[t+1]+=n[t+1]*l,i[t+2]+=n[t+2]*l}B(u);for(let o=s;o<y;o++){const t=o*3;e[t]=0,e[t+1]=0,e[t+2]=0}for(let o=s;o<y;o++){const t=o*3,G=i[t],N=i[t+1],W=i[t+2];let _=0,M=0,q=0;for(let h=0;h<r;h++){if(o===h)continue;const S=h*3,p=i[S]-G,x=i[S+1]-N,I=i[S+2]-W,z=p*p+x*x+I*I+.25,b=Math.sqrt(z),k=1*F[h]/(z*b);_+=p*k,M+=x*k,q+=I*k}e[t]=_,e[t+1]=M,e[t+2]=q}for(let o=s;o<y;o++){const t=o*3;n[t]+=e[t]*d,n[t+1]+=e[t+1]*d,n[t+2]+=e[t+2]*d}self.postMessage({type:"done"})}}})();
