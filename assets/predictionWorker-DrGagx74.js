(function(){"use strict";const N={G:1,SOFTENING_SQ:.25},{G:j,SOFTENING_SQ:q}=N;function w(l){const n=l.length,i={count:n,positions:new Float64Array(n*3),velocities:new Float64Array(n*3),accelerations:new Float64Array(n*3),masses:new Float64Array(n)};for(let o=0;o<n;o++){const s=l[o];i.positions[o*3]=s.position.x,i.positions[o*3+1]=s.position.y,i.positions[o*3+2]=s.position.z,i.velocities[o*3]=s.velocity.x,i.velocities[o*3+1]=s.velocity.y,i.velocities[o*3+2]=s.velocity.z,i.masses[o]=s.mass}return i}function x(l){const{count:n,positions:i,accelerations:o,masses:s}=l;o.fill(0);for(let c=0;c<n;c++){const e=c*3,a=i[e],t=i[e+1],r=i[e+2];for(let p=c+1;p<n;p++){const f=p*3,u=i[f]-a,y=i[f+1]-t,S=i[f+2]-r,v=u*u+y*y+S*S+q,O=Math.sqrt(v),h=j/(v*O),F=u*h,_=y*h,A=S*h,d=s[c],m=s[p];o[e]+=F*m,o[e+1]+=_*m,o[e+2]+=A*m,o[f]-=F*d,o[f+1]-=_*d,o[f+2]-=A*d}}}function z(l,n){const{count:i,positions:o,velocities:s,accelerations:c}=l,e=.5*n;for(let a=0;a<i;a++){const t=a*3;s[t]+=c[t]*e,s[t+1]+=c[t+1]*e,s[t+2]+=c[t+2]*e,o[t]+=s[t]*n,o[t+1]+=s[t+1]*n,o[t+2]+=s[t+2]*n}x(l);for(let a=0;a<i;a++){const t=a*3;s[t]+=c[t]*e,s[t+1]+=c[t+1]*e,s[t+2]+=c[t+2]*e}}function G(l,n,i,o){const s=w(l),c=l.map(t=>t.id),e={};l.forEach(t=>{e[t.id]=t.color});const a={};for(let t=0;t<s.count;t++)a[c[t]]=[[s.positions[t*3],s.positions[t*3+1],s.positions[t*3+2]]];for(let t=0;t<n;t++)if(z(s,i),t%o===0)for(let r=0;r<s.count;r++){const p=c[r];a[p]&&a[p].push([s.positions[r*3],s.positions[r*3+1],s.positions[r*3+2]])}return{type:"result",paths:Object.keys(a).map(t=>({id:t,points:a[t],color:e[t]||"white"}))}}self.onmessage=l=>{if(l.data.type==="predict"){const{bodies:n,steps:i,dt:o,saveFrequency:s}=l.data,c=G(n,i,o,s);self.postMessage(c)}}})();
