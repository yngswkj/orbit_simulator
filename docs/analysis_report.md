# orbit-simulator プロジェクト分析レポート

**作成日**: 2025年12月27日
**対象バージョン**: 0.1.0
**分析者**: Claude Code

---

## 1. プロジェクト概要

### 1.1 基本情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | orbit-simulator |
| 説明 | ブラウザ上で動作する3D多体重力シミュレーター |
| 技術スタック | React 19 + TypeScript + Three.js + Vite |
| 状態管理 | Zustand |
| デプロイ先 | GitHub Pages / Vercel |

### 1.2 ディレクトリ構成

```
orbit-simulator/
├── src/
│   ├── components/
│   │   ├── scene/           # 3Dシーン関連
│   │   │   ├── CelestialBody.tsx
│   │   │   ├── OrbitPrediction.tsx
│   │   │   └── Scene.tsx
│   │   └── ui/              # UIコンポーネント
│   │       ├── BodyCreator.tsx
│   │       ├── BodyInspector.tsx
│   │       ├── ControlPanel.tsx
│   │       ├── HelpModal.tsx
│   │       ├── SimulationControls.tsx
│   │       └── Tour.tsx
│   ├── hooks/
│   │   └── usePhysicsLoop.ts
│   ├── store/
│   │   └── physicsStore.ts
│   ├── types/
│   │   └── physics.ts
│   ├── utils/
│   │   ├── i18n.ts
│   │   ├── physics.ts
│   │   └── solarSystem.ts
│   ├── App.tsx
│   └── main.tsx
├── public/
│   └── textures/            # 天体テクスチャ
├── docs/                    # ドキュメント
├── .github/workflows/       # CI/CD
├── package.json
├── vite.config.ts
└── tsconfig.json
```

---

## 2. 機能一覧

### 2.1 物理シミュレーション機能

| 機能 | 実装状況 | 説明 |
|------|:--------:|------|
| N体重力計算 | ✅ | 万有引力の法則に基づく多体シミュレーション |
| Velocity Verlet積分 | ✅ | エネルギー保存性に優れたシンプレクティック積分器 |
| 衝突検出 | ✅ | 天体同士の重なりを検出 |
| 衝突合体処理 | ✅ | 運動量・質量・体積保存を実装 |
| 時間スケール調整 | ✅ | 0.1倍〜100倍の速度制御 |
| 固定天体 | ✅ | 動かない天体（太陽など）の設定 |

### 2.2 ビジュアル機能

| 機能 | 実装状況 | 説明 |
|------|:--------:|------|
| 3Dレンダリング | ✅ | Three.js + React Three Fiber |
| 天体テクスチャ | ✅ | リアルな惑星表面の表現 |
| 軌道トレイル | ✅ | 天体の軌跡を最大150点まで表示 |
| 軌道予測線 | ✅ | 将来の軌道経路を可視化 |
| 背景星 | ✅ | 5000個のランダム星配置 |
| 無限グリッド | ✅ | 空間把握用のグリッド表示 |
| 座標軸 | ✅ | XYZ軸のギズモ表示 |
| ハビタブルゾーン | ✅ | 生命居住可能領域の可視化 |

### 2.3 カメラ・操作機能

| 機能 | 実装状況 | 説明 |
|------|:--------:|------|
| Freeモード | ✅ | 自由視点（OrbitControls） |
| Sun Lockモード | ✅ | 太陽を中心とした回転視点 |
| Surface Lockモード | ✅ | FPSスタイルの地表視点 |
| 天体追従 | ✅ | 選択した天体をカメラが追跡 |
| マウス操作 | ✅ | 回転・パン・ズーム |
| キーボードショートカット | ✅ | Space、Shift+1-3、数字キーなど |

### 2.4 天体管理機能

| 機能 | 実装状況 | 説明 |
|------|:--------:|------|
| カスタム天体作成 | ✅ | 質量・半径・速度・色を指定 |
| ランダム天体生成 | ✅ | ワンクリックでランダム天体を追加 |
| 天体削除 | ✅ | 選択した天体を削除 |
| 太陽系プリセット | ✅ | 8惑星+太陽の精密データ |
| 天体詳細表示 | ✅ | 選択天体の情報をインスペクタ表示 |

### 2.5 UI/UX機能

| 機能 | 実装状況 | 説明 |
|------|:--------:|------|
| 日英2言語対応 | ✅ | ブラウザ設定から自動検出 |
| ツアーガイド | ✅ | React Joyrideによる機能紹介 |
| ヘルプモーダル | ✅ | 操作方法・更新履歴の表示 |
| 自動折りたたみパネル | ✅ | 5秒後に自動収納 |
| レスポンシブデザイン | ✅ | モバイル・タブレット対応 |

---

## 3. 技術スタック詳細

### 3.1 依存パッケージ

#### ランタイム依存

| パッケージ | バージョン | 用途 |
|-----------|----------|------|
| react | ^19.2.0 | UIフレームワーク |
| react-dom | ^19.2.0 | React DOM操作 |
| three | ^0.182.0 | 3Dグラフィックス |
| @react-three/fiber | ^9.4.2 | React ⇔ Three.jsバインディング |
| @react-three/drei | ^10.7.7 | R3Fユーティリティ |
| zustand | ^5.0.9 | 状態管理 |
| uuid | ^13.0.0 | ID生成 |
| leva | ^0.10.1 | デバッグUIコントローラー |
| lucide-react | ^0.562.0 | アイコン |
| react-joyride | ^2.9.3 | ツアーガイド |

#### 開発依存

| パッケージ | バージョン | 用途 |
|-----------|----------|------|
| vite | ^7.2.4 | バンドラー・開発サーバー |
| typescript | ~5.9.3 | 型システム |
| eslint | ^9.39.1 | Linter |
| @vitejs/plugin-react | ^5.1.1 | React Fast Refresh |

### 3.2 物理演算エンジン仕様

```typescript
// 定数
const G = 1;              // 万有引力定数（単位系調整済み）
const SOFTENING = 0.5;    // 数値安定性のためのソフトニング係数
const BASE_DT = 0.001;    // 基本時間ステップ

// 加速度計算（万有引力）
// a = Σ (G * m_other / (r² + ε²)^1.5) * r_vec

// 積分法: Velocity Verlet
// 1. a(t) = calculateAcceleration(r(t))
// 2. v(t + 0.5dt) = v(t) + 0.5 * a(t) * dt
// 3. r(t + dt) = r(t) + v(t + 0.5dt) * dt
// 4. a(t + dt) = calculateAcceleration(r(t + dt))
// 5. v(t + dt) = v(t + 0.5dt) + 0.5 * a(t + dt) * dt

// 衝突判定
// distance < (r1 + r2) * 0.8
```

---

## 4. 課題・問題点

### 4.1 テスト・品質保証

| 課題 | 重要度 | 詳細 |
|------|:------:|------|
| 自動テストなし | 高 | Jest/Vitestなどのテストフレームワーク未導入 |
| E2Eテストなし | 中 | Playwright/Cypressなどの統合テスト未実装 |
| 型チェックスクリプトなし | 中 | `npm run type-check`が未定義 |

### 4.2 パフォーマンス

| 課題 | 重要度 | 詳細 |
|------|:------:|------|
| O(N²)計算量 | 高 | 天体数が増えると計算コストが急増 |
| 固定時間ステップ | 中 | 複雑な軌道では精度が不足する可能性 |
| 軌道予測の重い計算 | 中 | リアルタイム計算でフレームレート低下の恐れ |
| メインスレッド負荷 | 中 | 物理演算がUIをブロックする可能性 |

### 4.3 データ管理

| 課題 | 重要度 | 詳細 |
|------|:------:|------|
| 永続化機能なし | 高 | シミュレーション状態の保存・読み込み不可 |
| エクスポート機能なし | 中 | 軌道データ、スクリーンショット出力不可 |
| プリセット不足 | 低 | 太陽系以外のシナリオがない |

### 4.4 ドキュメント

| 課題 | 重要度 | 詳細 |
|------|:------:|------|
| README未整備 | 高 | 汎用テンプレートのまま |
| セットアップ手順不明 | 高 | インストール・ビルド方法の記載なし |
| API/型定義の説明不足 | 中 | 開発者向けドキュメントがない |

### 4.5 エラーハンドリング

| 課題 | 重要度 | 詳細 |
|------|:------:|------|
| テクスチャ読み込み失敗 | 中 | フォールバック処理が不明確 |
| 数値オーバーフロー | 中 | 極端な質量・速度での挙動が未検証 |
| WebGL非対応 | 低 | エラーメッセージがない |

### 4.6 アクセシビリティ

| 課題 | 重要度 | 詳細 |
|------|:------:|------|
| スクリーンリーダー対応 | 中 | ARIA属性の整備状況が不明 |
| 色覚多様性 | 低 | カラーブラインド対応の検証が未実施 |

### 4.7 モバイル体験

| 課題 | 重要度 | 詳細 |
|------|:------:|------|
| タッチジェスチャ | 中 | ピンチズーム、スワイプの最適化が不明 |
| モバイルパフォーマンス | 中 | モバイルGPUでのフレームレート未検証 |
| PWA機能 | 低 | オフライン対応が未実装 |

---

## 5. 総合評価

### 5.1 評価サマリー

| 項目 | 評価 | コメント |
|------|:----:|---------|
| アーキテクチャ | ⭐⭐⭐⭐ | Zustand + R3Fの構成が適切 |
| 物理演算 | ⭐⭐⭐ | Velocity Verletは良いが最適化の余地あり |
| UI/UX | ⭐⭐⭐⭐ | 多言語、ツアー、ショートカットが充実 |
| コード品質 | ⭐⭐⭐ | TypeScript strictモードだがテスト不足 |
| ドキュメント | ⭐⭐ | docsフォルダはあるがREADME未整備 |
| パフォーマンス | ⭐⭐⭐ | 10-20天体では快適、100個以上は厳しい |

### 5.2 スケーラビリティ分析

| 天体数 | 計算回数/フレーム | 予想FPS | 体験品質 |
|-------:|------------------:|--------:|----------|
| 10 | 100 | 60 | 快適 |
| 20 | 400 | 60 | 快適 |
| 50 | 2,500 | 45-60 | 良好 |
| 100 | 10,000 | 20-30 | やや重い |
| 200 | 40,000 | 5-10 | 厳しい |
| 500 | 250,000 | <5 | 使用不可 |

### 5.3 強み

1. **モダンな技術スタック**: React 19 + TypeScript + Viteの最新構成
2. **物理的正確性**: Velocity Verlet法によるエネルギー保存
3. **直感的なUI**: 多言語対応、ツアーガイド、キーボードショートカット
4. **拡張性のある設計**: Zustandによる状態管理、コンポーネント分離
5. **教育的価値**: 軌道力学の視覚的理解に役立つ

### 5.4 弱み

1. **テストの欠如**: 自動テストがなく、品質保証が困難
2. **スケーラビリティ**: 多天体シミュレーションでのパフォーマンス問題
3. **ドキュメント不足**: README、API仕様書がない
4. **永続化なし**: 作成したシミュレーションを保存できない

---

## 6. 推奨アクション

### 6.1 短期（1-2週間）

1. README.mdの整備
2. `npm run type-check`スクリプトの追加
3. 基本的なエラーハンドリングの実装

### 6.2 中期（1-2ヶ月）

1. パフォーマンス最適化（別紙「改善計画書」参照）
2. シミュレーション保存・読み込み機能
3. Vitestによるユニットテスト導入

### 6.3 長期（3ヶ月以上）

1. Web Worker並列化
2. PWA対応
3. E2Eテスト導入
4. 追加プリセット（二重星系、トロヤ群など）

---

## 付録A: ファイル別コード行数

| ファイル | 行数 | 主な責務 |
|----------|-----:|---------|
| Scene.tsx | 292 | 3Dシーン・カメラ制御 |
| i18n.ts | 196 | 多言語対応 |
| CelestialBody.tsx | 174 | 天体メッシュ・トレイル |
| physics.ts | 145 | 物理演算ロジック |
| physicsStore.ts | 134 | 状態管理 |
| solarSystem.ts | 130 | 太陽系プリセットデータ |
| App.tsx | 128 | ルートコンポーネント |
| physics.ts (types) | 20 | 型定義 |
| usePhysicsLoop.ts | 13 | 物理演算ループフック |

---

## 付録B: 依存関係グラフ

```
App.tsx
├── Scene.tsx
│   ├── CelestialBody.tsx
│   │   └── physicsStore.ts
│   ├── OrbitPrediction.tsx
│   │   └── physics.ts
│   └── physicsStore.ts
├── ControlPanel.tsx
│   ├── SimulationControls.tsx
│   ├── BodyCreator.tsx
│   └── physicsStore.ts
├── BodyInspector.tsx
│   └── physicsStore.ts
├── Tour.tsx
│   └── i18n.ts
├── HelpModal.tsx
│   └── i18n.ts
└── usePhysicsLoop.ts
    ├── physics.ts
    └── physicsStore.ts
```

---

*本レポートはorbit-simulator v0.1.0のソースコード分析に基づいて作成されました。*
